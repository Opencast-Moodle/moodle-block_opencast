define("block_opencast/block_massaction",["exports","jquery","core/str","core/notification","core/modal_save_cancel","core/modal_events","core/url"],(function(_exports,_jquery,str,_notification,_modal_save_cancel,_modal_events,_url){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Javascript module to instantiate the Mass-Action functionality.
   *
   * @module     block_opencast
   * @copyright  2024 Farbod Zamani Boroujeni (elan e.V.) (zamani@elan-ev.de)
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(str),_notification=_interopRequireDefault(_notification),_modal_save_cancel=_interopRequireDefault(_modal_save_cancel),_modal_events=_interopRequireDefault(_modal_events),_url=_interopRequireDefault(_url);_exports.init=(courseid,ocinstanceid,selectors)=>{[...document.querySelectorAll(selectors.dropdown)].forEach((dropdown=>{dropdown.addEventListener("change",(e=>{var _actionsmapping$actio,_actionsmapping$actio2,_actionsmapping$actio3;const element=e.currentTarget,id=element.getAttribute("id"),action=element.value,populatedselector="".concat(selectors.dropdown,":not(#").concat(id,")"),otherdropdowns=[...document.querySelectorAll(populatedselector)];if(otherdropdowns.length&&otherdropdowns.forEach((otherdropdown=>{otherdropdown.value=action})),""===action)return;const selectedvideos=[...document.querySelectorAll("".concat(selectors.selectitem,":checked"))];if(!selectedvideos.length)return;const selectedids=selectedvideos.map((element=>element.id.substring(7))),selectedtitles=selectedvideos.map((element=>element.name.substring(7))),actionsmappinginput=document.getElementById(selectors.actionmapping),actionsmappingraw=actionsmappinginput?actionsmappinginput.value:null;if(null===actionsmappingraw)return;const actionsmapping=JSON.parse(actionsmappingraw);if(null==actionsmapping||null===(_actionsmapping$actio=actionsmapping[action])||void 0===_actionsmapping$actio||null===(_actionsmapping$actio2=_actionsmapping$actio.path)||void 0===_actionsmapping$actio2||!_actionsmapping$actio2.url)return;if("startworkflow"===action){const data={type:"bulk",selectedids:selectedids,selectedtitles:selectedtitles,url:actionsmapping[action].path.url},event=new CustomEvent("click",{detail:data});return void document.querySelector(".start-workflow").dispatchEvent(event)}const stringskeys=[{key:"videostable_massaction_"+action+"_modal_title",component:"block_opencast"},{key:"videostable_massaction_"+action+"_modal_body",component:"block_opencast",param:selectedtitles.join("</li><li>")},{key:"videostable_massaction_"+action,component:"block_opencast"}],strPromise=str.get_strings(stringskeys),modalPromise=_modal_save_cancel.default.create({});var urlParams={ocinstanceid:ocinstanceid,courseid:courseid};null!==(_actionsmapping$actio3=actionsmapping[action].path)&&void 0!==_actionsmapping$actio3&&_actionsmapping$actio3.params&&(urlParams=Object.assign(urlParams,actionsmapping[action].path.params));const actionUrl=_url.default.relativeUrl(actionsmapping[action].path.url,urlParams);_jquery.default.when(strPromise,modalPromise).then((function(strings,modal){window.liveUpdateState="paused",modal.setTitle(strings[0]);var body='<form id="mass_action_confirmation_form" method="post" action="'+actionUrl+'">';body+="<p>"+strings[1]+"</p>";for(let selectedid of selectedids)body+='<input type="hidden" name="videoids[]" value="'+selectedid+'">';return body+='<input type="hidden" name="ismassaction" value="1">',body+="</form>",modal.setBody(body),modal.setSaveButtonText(strings[2]),modal.getRoot().on(_modal_events.default.save,(function(){window.liveUpdateState="resumed",document.getElementById("mass_action_confirmation_form").submit()})),modal.getRoot().on(_modal_events.default.hidden,(function(){window.liveUpdateState="resumed",modal.destroy(),resetVideosTableBulkActions(selectors)})),modal.show(),modal})).fail(_notification.default.exception)}))}))};const resetVideosTableBulkActions=selectors=>{[...document.querySelectorAll(selectors.dropdown)].forEach((dropdown=>{dropdown.value="",dropdown.setAttribute("disabled",!0)}));[...document.querySelectorAll("".concat(selectors.selectall,", ").concat(selectors.selectitem))].forEach((input=>{input.checked=!1}))}}));

//# sourceMappingURL=block_massaction.min.js.map