define("block_opencast/block_settings",["exports","block_opencast/tabulator","jquery","core/modal_factory","core/modal_events","core/str","core/notification"],(function(_exports,_tabulator,_jquery,_modal_factory,_modal_events,str,_notification){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Javascript to initialise the opencast block settings.
   *
   * @module     block/opencast
   * @copyright  2021 Tamara Gunkel, University of MÃ¼nster
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_tabulator=_interopRequireDefault(_tabulator),_jquery=_interopRequireDefault(_jquery),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(str),_notification=_interopRequireDefault(_notification);_exports.init=(rolesinputid,metadatainputid,metadataseriesinputid,ocinstanceid)=>{str.get_strings([{key:"heading_role",component:"block_opencast"},{key:"heading_actions",component:"block_opencast"},{key:"heading_permanent",component:"block_opencast"},{key:"delete_role",component:"block_opencast"},{key:"delete_confirm_role",component:"block_opencast"},{key:"delete_metadata",component:"block_opencast"},{key:"delete_confirm_metadata",component:"block_opencast"},{key:"heading_name",component:"block_opencast"},{key:"heading_datatype",component:"block_opencast"},{key:"heading_description",component:"block_opencast"},{key:"heading_required",component:"block_opencast"},{key:"heading_readonly",component:"block_opencast"},{key:"heading_params",component:"block_opencast"},{key:"heading_defaultable",component:"block_opencast"},{key:"delete",component:"moodle"}]).then((function(jsstrings){var rolesinput=(0,_jquery.default)("#"+rolesinputid);if(rolesinput.parent().hide(),rolesinput.parent().next().hide(),rolesinput.length){var metadatainput=(0,_jquery.default)("#"+metadatainputid);metadatainput.parent().hide(),metadatainput.parent().next().hide();var metadataseriesinput=(0,_jquery.default)("#"+metadataseriesinputid);metadataseriesinput.parent().hide(),metadataseriesinput.parent().next().hide();var rolestable=new _tabulator.default("#rolestable_"+ocinstanceid,{data:JSON.parse(rolesinput.val()),layout:"fitColumns",dataChanged:function(data){data=data.filter((value=>value.rolename)),rolesinput.val(JSON.stringify(data))},columns:[{title:jsstrings[0],field:"rolename",editor:"input",widthGrow:4,cellEdited:function(cell){cell.getData().rolename.includes("[USERNAME]")||cell.getData().rolename.includes("[USERNAME_LOW]")||cell.getData().rolename.includes("[USERNAME_UP]")?(cell.getRow().update({permanent:1}),cell.getRow().getCell("permanent").getElement().getElementsByTagName("input")[0].disabled=!0):cell.getRow().getCell("permanent").getElement().getElementsByTagName("input")[0].disabled=!1}},{title:jsstrings[1],field:"actions",editor:"input",widthGrow:1},{title:jsstrings[2],field:"permanent",hozAlign:"center",widthGrow:0,formatter:function(cell){var input=document.createElement("input");return input.type="checkbox",input.checked=cell.getValue(),input.addEventListener("click",(function(){cell.getRow().update({permanent:(0,_jquery.default)(this).prop("checked")?1:0})})),(cell.getData().rolename.includes("[USERNAME]")||cell.getData().rolename.includes("[USERNAME_LOW]")||cell.getData().rolename.includes("[USERNAME_UP]"))&&(input.disabled=!0),input}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function(){return'<i class="icon fa fa-trash fa-fw"></i>'},cellClick:function(e,cell){_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:jsstrings[3],body:jsstrings[4]}).then((function(modal){modal.setSaveButtonText(jsstrings[3]),modal.getRoot().on(_modal_events.default.save,(function(){cell.getRow().delete()})),modal.show()})).catch(_notification.default.exception)}}]});(0,_jquery.default)("#addrow-rolestable_"+ocinstanceid).click((function(){rolestable.addRow({rolename:"",actions:"",permanent:0})}));var metadatatable=new _tabulator.default("#metadatatable_"+ocinstanceid,{data:JSON.parse(metadatainput.val()),layout:"fitColumns",movableRows:!0,rowMoved:function(){var data=metadatatable.getRows().map((row=>row.getData()));data=data.filter((value=>value.name)),metadatainput.val(JSON.stringify(data))},dataChanged:function(){var data=metadatatable.getRows().map((row=>row.getData()));data=data.filter((value=>value.name)),(0,_jquery.default)("#"+metadatainputid).val(JSON.stringify(data))},columns:[{title:jsstrings[7]+"   "+(0,_jquery.default)("#helpbtnname_"+ocinstanceid).html(),field:"name",editor:"input",widthGrow:1,headerSort:!1},{title:jsstrings[8],field:"datatype",widthGrow:1,headerSort:!1,editor:"select",editorParams:{values:{text:"String (text)",select:"Drop Down (select)",autocomplete:"Arrays (autocomplete)",textarea:"Long Text (textarea)",date_time_selector:"Date Time Selector (datetime)"}}},{title:jsstrings[9]+"   "+(0,_jquery.default)("#helpbtndescription_"+ocinstanceid).html(),field:"description",editor:"textarea",widthGrow:2,headerSort:!1},{title:jsstrings[10],field:"required",hozAlign:"center",widthGrow:0,headerSort:!1,formatter:function(cell){var input=document.createElement("input");return input.type="checkbox",input.checked=cell.getValue(),input.addEventListener("click",(function(){cell.getRow().update({required:(0,_jquery.default)(this).prop("checked")?1:0})})),input}},{title:jsstrings[11],field:"readonly",hozAlign:"center",widthGrow:0,headerSort:!1,formatter:function(cell){var input=document.createElement("input");return input.type="checkbox",input.checked=cell.getValue(),input.addEventListener("click",(function(){cell.getRow().update({readonly:(0,_jquery.default)(this).prop("checked")?1:0})})),input}},{title:jsstrings[12]+"   "+(0,_jquery.default)("#helpbtnparams_"+ocinstanceid).html(),field:"param_json",editor:"textarea",widthGrow:2,headerSort:!1},{title:jsstrings[13]+"   "+(0,_jquery.default)("#helpbtndefaultable_"+ocinstanceid).html(),field:"defaultable",hozAlign:"center",widthGrow:0,headerSort:!1,formatter:function(cell){if("title"!=cell.getRow().getCell("name").getValue()){var input=document.createElement("input");input.type="checkbox",input.checked=cell.getValue(),input.addEventListener("click",(function(){cell.getRow().update({defaultable:(0,_jquery.default)(this).prop("checked")?1:0})}))}}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function(){return'<i class="icon fa fa-trash fa-fw"></i>'},cellClick:function(e,cell){_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:jsstrings[5],body:jsstrings[6]}).then((function(modal){modal.setSaveButtonText(jsstrings[14]),modal.getRoot().on(_modal_events.default.save,(function(){cell.getRow().delete()})),modal.show()})).catch(_notification.default.exception)}}]});(0,_jquery.default)("#addrow-metadatatable_"+ocinstanceid).click((function(){metadatatable.addRow({datatype:"text",required:0,readonly:0,param_json:null})}));var metadataseriestable=new _tabulator.default("#metadataseriestable_"+ocinstanceid,{data:JSON.parse(metadataseriesinput.val()),layout:"fitColumns",movableRows:!0,rowMoved:function(){var data=metadataseriestable.getRows().map((row=>row.getData()));data=data.filter((value=>value.name)),metadataseriesinput.val(JSON.stringify(data))},dataChanged:function(){var data=metadataseriestable.getRows().map((row=>row.getData()));data=data.filter((value=>value.name)),(0,_jquery.default)("#"+metadataseriesinputid).val(JSON.stringify(data))},columns:[{title:jsstrings[7]+"   "+(0,_jquery.default)("#helpbtnname_"+ocinstanceid).html(),field:"name",editor:"input",widthGrow:1,headerSort:!1},{title:jsstrings[8],field:"datatype",widthGrow:1,headerSort:!1,editor:"select",editorParams:{values:{text:"String (text)",select:"Drop Down (select)",autocomplete:"Arrays (autocomplete)",textarea:"Long Text (textarea)",date_time_selector:"Date Time Selector (datetime)"}}},{title:jsstrings[9]+"   "+(0,_jquery.default)("#helpbtndescription_"+ocinstanceid).html(),field:"description",editor:"textarea",widthGrow:2,headerSort:!1},{title:jsstrings[10],field:"required",hozAlign:"center",widthGrow:0,headerSort:!1,formatter:function(cell){var input=document.createElement("input");return input.type="checkbox",input.checked=cell.getValue(),input.addEventListener("click",(function(){cell.getRow().update({required:(0,_jquery.default)(this).prop("checked")?1:0})})),input}},{title:jsstrings[11],field:"readonly",hozAlign:"center",widthGrow:0,headerSort:!1,formatter:function(cell){var input=document.createElement("input");return input.type="checkbox",input.checked=cell.getValue(),input.addEventListener("click",(function(){cell.getRow().update({readonly:(0,_jquery.default)(this).prop("checked")?1:0})})),input}},{title:jsstrings[12]+"   "+(0,_jquery.default)("#helpbtnparams_"+ocinstanceid).html(),field:"param_json",editor:"textarea",widthGrow:2,headerSort:!1},{title:jsstrings[13]+"   "+(0,_jquery.default)("#helpbtndefaultable_"+ocinstanceid).html(),field:"defaultable",hozAlign:"center",widthGrow:0,headerSort:!1,formatter:function(cell){if("title"!=cell.getRow().getCell("name").getValue()){var input=document.createElement("input");input.type="checkbox",input.checked=cell.getValue(),input.addEventListener("click",(function(){cell.getRow().update({defaultable:(0,_jquery.default)(this).prop("checked")?1:0})}))}}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function(){return'<i class="icon fa fa-trash fa-fw"></i>'},cellClick:function(e,cell){_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:jsstrings[5],body:jsstrings[6]}).then((function(modal){modal.setSaveButtonText(jsstrings[14]),modal.getRoot().on(_modal_events.default.save,(function(){cell.getRow().delete()})),modal.show()})).catch(_notification.default.exception)}}]});(0,_jquery.default)("#addrow-metadataseriestable_"+ocinstanceid).click((function(){metadataseriestable.addRow({datatype:"text",required:0,readonly:0,param_json:null})}))}})).catch(_notification.default.exception)}}));

//# sourceMappingURL=block_settings.min.js.map