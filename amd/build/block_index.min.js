/**
 * Javascript to initialise the opencast block.
 *
 * @module     block_opencast
 * @copyright  2021 Tamara Gunkel, University of MÃ¼nster
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_opencast/block_index",["jquery","core/modal_factory","core/modal_events","core/str","core/url","core/notification"],(function($,ModalFactory,ModalEvents,str,url,Notification){return{init:function(courseid,ocinstanceid){str.get_strings([{key:"reportproblem_modal_title",component:"block_opencast"},{key:"reportproblem_modal_body",component:"block_opencast"},{key:"reportproblem_modal_placeholder",component:"block_opencast"},{key:"reportproblem_modal_required",component:"block_opencast"},{key:"reportproblem_modal_submit",component:"block_opencast"},{key:"startworkflow",component:"block_opencast"},{key:"startworkflow_modal_body",component:"block_opencast"}]).then((function(results){!function(ocinstanceid,courseid,langstrings){if(document.getElementById("workflowsjson")){var workflows=JSON.parse($("#workflowsjson").text());$(".start-workflow").on("click",(function(e){e.preventDefault();var clickedVideo=$(e.currentTarget),select='<select class="custom-select mb-3" id="workflowselect" name="workflow">';for(let workflow in workflows)select+='<option value="'+workflow+'">'+workflows[workflow].title+"</option>";select+="</select>",ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:langstrings[5],body:'<form id="startWorkflowForm" method="post" action="'+url.relativeUrl("blocks/opencast/startworkflow.php",{ocinstanceid:ocinstanceid,courseid:courseid,videoid:clickedVideo.data("id")})+'"><div class="form-group"><p>'+langstrings[6]+"</p>"+select+'<div id="workflowdesc"></div><iframe id="config-frame" class="w-100 mh-100 border-0" sandbox="allow-forms allow-scripts" src=""></iframe><input type="hidden" name="configparams" id="configparams"></form>'},void 0).then((function(modal){modal.setSaveButtonText(langstrings[5]),modal.getRoot().on(ModalEvents.save,(function(e){document.getElementById("config-frame").contentWindow.postMessage("getdata","*"),e.preventDefault()})),modal.show().then((function(){const workflowselect=$("#workflowselect");$("#workflowdesc").html(workflows[workflowselect.val()].description),$("#config-frame").attr("src",url.relativeUrl("blocks/opencast/serveworkflowconfigpanel.php",{ocinstanceid:ocinstanceid,courseid:courseid,workflowid:workflowselect.val()})),workflowselect.change((function(){let workflowid=$(this).val();$("#workflowdesc").html(workflows[workflowid].description),$("#config-frame").attr("src",url.relativeUrl("blocks/opencast/serveworkflowconfigpanel.php",{ocinstanceid:ocinstanceid,courseid:courseid,workflowid:workflowid}))}))})).catch(Notification.exception)})).catch(Notification.exception)}))}}(ocinstanceid,courseid,results),function(ocinstanceid,courseid,langstrings){$(".report-problem").on("click",(function(e){e.preventDefault();var clickedVideo=$(e.currentTarget);ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:langstrings[0],body:'<form id="reportProblemForm" method="post" action="'+url.relativeUrl("blocks/opencast/reportproblem.php",{ocinstanceid:ocinstanceid,courseid:courseid,videoid:clickedVideo.data("id")})+'"><div class="form-group"><label for="inputMessage">'+langstrings[1]+'</label><textarea class="form-control" id="inputMessage" name="inputMessage" rows="4" placeholder="'+langstrings[2]+'"></textarea>  <div class="invalid-feedback d-none" id="messageValidation">'+langstrings[3]+"</div></div></form>"}).then((function(modal){modal.setSaveButtonText(langstrings[4]),modal.getRoot().on(ModalEvents.save,(function(e){$("#inputMessage").val()?$("#reportProblemForm").submit():($("#inputMessage").addClass("is-invalid"),$("#messageValidation").removeClass("d-none")),e.preventDefault()})),modal.show()})).catch(Notification.exception)}))}(ocinstanceid,courseid,results)})).catch(Notification.exception),window.addEventListener("message",(function(event){"null"===event.origin&&(event.data===parseInt(event.data)?$("#config-frame").height(event.data):($("#configparams").val(event.data),$("#startWorkflowForm").submit()))}))}}}));

//# sourceMappingURL=block_index.min.js.map