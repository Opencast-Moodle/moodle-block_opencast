/**
 * Javascript to initialise the opencast block.
 *
 * @module     block_opencast
 * @copyright  2019 Farbod Zamani (zamani@elan-ev.de)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_opencast/block_form_handler",["jquery"],(function($){function afterUpload(){window.presentationRun||window.presenterRun||(clearInterval(window.presentationIntervalHandle),clearInterval(window.presenterIntervalHandle),$('[name="submitbutton"]').removeAttr("disabled"))}function autocompletePrettifier(){$('div[data-fieldtype="autocomplete"]').each((function(i,elm){var input=$(elm).find("input");input.hasClass("form-control")||input.addClass("form-control")}))}function setDefaultTitle(filename){if(!$('input[name="title"]').val()&&filename){let filenameArray=filename.split(".");filenameArray.length>1&&filenameArray.pop(),filename=filenameArray.join("."),$('input[name="title"]').val(filename)}}function getFilenameFromFilelist(filelist){var filename="";if(filelist.length){var filelinks=filelist.find(".filepicker-filename > a");filename=filelinks.length?$(filelinks[0]).text():""}return filename}window.presenterIntervalHandle=null,window.presentationIntervalHandle=null,window.presenterRun=!1,window.presentationRun=!1;return{init:function(){$("#termsofuse").hide(),$("#termsofuse_toggle").on("click",(function(e){$("#termsofuse").toggle(),e.preventDefault()})),$('.local_chunkupload input[type="file"]').on("change",(function(e){setTimeout((function(){var span=$(e.currentTarget).siblings("label.chunkupload-label").find(".chunkupload-filename");span.length&&setDefaultTitle($(span[0]).text())}),500)})),$(".filepickerhidden").on("change",(function(e){setTimeout((function(){setDefaultTitle(getFilenameFromFilelist($(e.currentTarget).parent().find(".filepicker-filelist")))}),500)})),$(".filepicker-filelist").on("drop",(function(e){var filelist=e.currentTarget,videoIdentifier=$(filelist).parent().siblings(".filepickerhidden").attr("name");$('[name="submitbutton"]').attr("disabled","disabled"),"video_presenter"==videoIdentifier?($(filelist).addClass("presenter-uploading"),window.presenterIntervalHandle=setInterval((function(){window.presenterRun=!0,$(".presenter-uploading").hasClass("dndupload-inprogress")||(window.presenterRun=!1,afterUpload())}),500)):($(filelist).addClass("presentation-uploading"),window.presenterIntervalHandle=setInterval((function(){window.presentationRun=!0,$(".presentation-uploading").hasClass("dndupload-inprogress")||(window.presentationRun=!1,afterUpload())}),500)),setTimeout((function(){setDefaultTitle(getFilenameFromFilelist(filelist))}),500)})),setTimeout((function(){autocompletePrettifier(),$(".moreless-actions").on("click",(function(){autocompletePrettifier()}))}),1e3)}}}));

//# sourceMappingURL=block_form_handler.min.js.map